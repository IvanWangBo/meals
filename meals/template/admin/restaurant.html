{% extends "base.html" %}
{% block title %}
    管理员-餐厅管理
{% endblock %}

{% block css_block %}
    <link rel="stylesheet" type="text/css" href="/static/css/admin/restaurant.css"/>

{% endblock %}


{% block body %}
<!--logo头部-->
<div class="whole">
    <div class="top">
        <i></i>企业团餐管理系统
    </div>
    <div class="top_tabs">
        <a class="js_top_tab top_tab" href="/admin/index">公司管理</a>
        <a class="js_top_tab top_tab chosen_1" href="/admin/restaurant">餐厅管理</a>
        <a class="js_top_tab top_tab" href="/admin/order">订单管理</a>
    </div>
    <div class="js_main main">
        <div class="line"></div>
        <!--tab切换-->
        <div class="tabs">
            <div class="js_tab tab" tab_num="1">餐厅管理</div>
        </div>
        <!--展示区-->
        <div class="js_secs secs">
            <!--用餐时间段-->
            <div class="js_list_1 sec_list">

            </div>
            <!--餐厅及餐品-->
            <div class="js_list_2 sec_list">

            </div>
        </div>
    </div>
    <div class="loading" style="display: none"></div>
    <div class="js_cover cover" style="display: none"></div>
    <div class="js_pop pop" style="display: none">
        <div class="pop_title">新建用餐时段</div>
        <div class="put_in">
            请输入名称：<input class="put_1" type="text" required="required" placeholder="请输入">
        </div>
        <div class="put_in">
            请输入开始时间：&nbsp;&nbsp;&nbsp;&nbsp;
            <select class="put_2" name="put_2" id="put_2">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
            </select>点
        </div>
        <div class="put_in">
            请输入结束时间：&nbsp;&nbsp;&nbsp;&nbsp;
            <select class="put_3" name="put_3" id="put_3">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
            </select>点
        </div>
        <div class="btns">
            <div class="btn js_add_time_range_btn">添加</div>
            <div class="btn js_close">取消</div>
        </div>
    </div>
</div>
{% endblock %}

{% block js_block %}
<script type="text/javascript">
    function addmin_index(){
        var self=this;
        self.body_node=$("body");
        self.load_node=$(".loading");
        self.is_loading=false;
        self.secs=$(".js_sec");
        self.cover=$(".js_cover");
        self.pop=$(".js_pop");
        self.user_id="";
        var tpl_1='<div class="js_time_range_list time_range_list">\
                        <%for(var i=0;i<data.length;i++){%>\
                            <div class="time_range time_range_<%=data[i].time_range_id%>" tid="<%=data[i].time_range_id%>"><%=data[i].name%></div>\
                        <%}%>\
                    </div>\
                    <div class="js_add_time_range add_time_range"><i>+</i>添加用餐时段</div>';
        //初始化用餐时段列表
        self.is_loading=true;
        self.load_node.show();
        $.getJSON("/api/restaurant/time_range/list/",function (d) {
            if(d.code==200){
                var node = $(util.parse(tpl_1, {
                    data: d.data,
                    util: util
                })).appendTo(".js_list_1");
            }else{
                alert(d.message);
            }
            self.is_loading=false;
            self.load_node.hide();
        });
        $("#js_add_btn").on("click",function () {
            if(self.is_loading){
                return;
            }
            self.is_loading=true;
            self.load_node.show();
            var company_name=$(".company_name").val();
            var province=$(".province").val();
            var address=$(".address").val();
            var phone_number=$(".phone_number").val();
            if(company_name&&province&&address&&phone_number){
                $.ajax({
                    url: "/api/company/add/",
                    type: "POST",
                    data: {
                        "company_name": company_name,
                        "province": province,
                        "address": address,
                        "phone_number": phone_number
                    },
                    success: function (d) {
                        if(d.code==200){
                            $(".company_name").val("");
                            $(".address").val("");
                            $(".phone_number").val("");
                            alert("公司管理员账号："+d.data.admin_name+",公司管理员密码："+d.data.password);
                        }else {
                            alert(d.message);
                        }
                        self.is_loading=false;
                        self.load_node.hide();
                    }
                })
            }else {
                alert("请补全信息");
            }
        });
        self.body_node.delegate(".js_add_time_range","click",function () {
            if(self.is_loading){
                return;
            }
            self.cover.show();
            self.pop.show();
        });
        self.body_node.delegate(".js_add_time_range_btn","click",function () {
            if(self.is_loading){
                return;
            }
            var pwd_1=$(".put_1").val();
            var pwd_2=$(".put_2").val();
            var pwd_3=$(".put_3").val();
            if(pwd_2&&pwd_3&&pwd_2>=pwd_3){
                alert("请输入合理时间段");
            }
            if(pwd_1&&pwd_2&&pwd_3){
                self.is_loading=true;
                self.load_node.show();
                $.ajax({
                    url: "/api/restaurant/time_range/add/",
                    type: "POST",
                    data: {
                        "name": pwd_1,
                        "start_time": pwd_2+":00:00",
                        "end_time":pwd_3+":00:00"
                    },
                    success: function (d) {
                        if(d.code==200){
                            //将用餐时段加入列表
                            var new_time_range=$('<div class="time_range">'+pwd_1+'</div>');
                            new_time_range.appendTo(".js_time_range_list");
                            new_time_range.addClass("time_range_"+d.data.time_range_id);
                            new_time_range.attr("tid",d.data.time_range_id);
                            //清除数据
                            $(".put_1").val("");
                            $(".put_2").val("");
                            $(".put_3").val("");
                            alert("添加成功");
                            self.cover.hide();
                            self.pop.hide();
                        }else{
                            alert(d.message);
                        }
                        self.is_loading=false;
                        self.load_node.hide();
                    }
                })
            }else{
                alert("请填写完整信息");
            }
        });
        self.body_node.delegate(".js_close","click",function () {
            if (self.is_loading) {
                return;
            }
            self.cover.hide();
            self.pop.hide();
        });
    }
    new addmin_index();
</script>
{% endblock %}